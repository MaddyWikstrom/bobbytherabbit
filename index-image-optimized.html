<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bungi x Bobby | The Tech Animal Collection</title>
    
    <!-- Critical resource hints -->
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="dns-prefetch" href="https://cdn.shopify.com">
    
    <!-- Preload critical images in WebP format -->
    <link rel="preload" as="image" href="assets/optimized/bobby-logo.webp" type="image/webp">
    <link rel="preload" as="image" href="assets/optimized/featured-hoodie.webp" type="image/webp">
    
    <!-- Inline favicon to avoid extra request -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üê∞</text></svg>">
    
    <!-- Ultra-critical CSS with image optimizations -->
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:system-ui,sans-serif;background:#0a0a0a;color:#fff;line-height:1.4}
        .loading{position:fixed;top:0;left:0;width:100%;height:100%;background:#0a0a0a;z-index:9999;display:flex;align-items:center;justify-content:center}
        .loading-text{color:#00ff88;font-size:2rem;font-weight:700}
        .hidden{display:none!important}
        .navbar{position:fixed;top:0;width:100%;background:rgba(10,10,10,.98);z-index:1000;padding:.8rem 0;backdrop-filter:blur(8px)}
        .nav-container{max-width:1200px;margin:0 auto;display:flex;justify-content:space-between;align-items:center;padding:0 1rem}
        .nav-brand{font-size:1.4rem;font-weight:700;color:#00ff88;text-decoration:none}
        .nav-menu{display:flex;list-style:none;gap:1.5rem}
        .nav-link{color:#fff;text-decoration:none;font-weight:500;transition:color .2s}
        .nav-link:hover{color:#00ff88}
        .cart-btn{background:#00ff88;border:0;padding:.6rem 1rem;border-radius:4px;color:#000;font-weight:600;cursor:pointer;display:flex;align-items:center;gap:.5rem}
        .hero{min-height:100vh;display:flex;align-items:center;justify-content:center;text-align:center;padding:80px 1rem 2rem}
        .hero-title{font-size:clamp(2rem,6vw,3.5rem);margin-bottom:1rem;color:#00ff88;font-weight:900;line-height:1.1}
        .subtitle{display:block;font-size:clamp(.9rem,2.5vw,1.3rem);color:#ccc;margin-top:.5rem}
        .hero-desc{font-size:1.1rem;margin:1.5rem 0;color:#aaa;max-width:600px}
        .cta-btn{background:linear-gradient(45deg,#00ff88,#00cc6a);border:0;padding:1rem 2rem;font-size:1.1rem;font-weight:600;color:#000;border-radius:4px;cursor:pointer;margin-top:1rem;transition:transform .2s}
        .cta-btn:hover{transform:translateY(-2px)}
        .section{padding:3rem 1rem}
        .container{max-width:1200px;margin:0 auto}
        .section-title{font-size:2rem;text-align:center;margin-bottom:2rem;color:#00ff88;font-weight:700}
        .products-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:1.5rem;margin:2rem 0}
        .product-card{background:rgba(26,26,46,.6);border-radius:8px;padding:1.5rem;text-align:center;border:1px solid rgba(0,255,136,.1);transition:transform .2s}
        .product-card:hover{transform:translateY(-3px);border-color:rgba(0,255,136,.3)}
        .product-title{margin-bottom:.5rem;font-size:1.1rem}
        .product-price{color:#00ff88;font-size:1.2rem;font-weight:600;margin-bottom:1rem}
        .add-btn{background:#00ff88;border:0;padding:.7rem 1.2rem;color:#000;font-weight:600;border-radius:4px;cursor:pointer;transition:background .2s}
        .add-btn:hover{background:#00cc6a}
        .footer{background:#0a0a0a;padding:2rem 1rem;border-top:1px solid rgba(0,255,136,.1);text-align:center}
        .footer-title{color:#00ff88;margin-bottom:.5rem}
        .footer-text{color:#aaa;font-size:.9rem}
        
        /* Image optimization styles */
        .optimized-img{width:100%;height:auto;object-fit:cover;transition:opacity .3s}
        .nav-logo-img{height:40px;width:auto}
        .hero-product-img{max-width:400px;height:auto;margin:2rem auto}
        .product-img{width:100%;height:200px;object-fit:cover;border-radius:8px;margin-bottom:1rem}
        
        /* Lazy loading placeholder */
        .img-placeholder{background:linear-gradient(90deg,#333 25%,#444 50%,#333 75%);background-size:200% 100%;animation:loading 1.5s infinite;border-radius:8px}
        @keyframes loading{0%{background-position:200% 0}100%{background-position:-200% 0}}
        
        @media(max-width:768px){.nav-menu{display:none}.nav-container{padding:0 1rem}.hero{padding:100px 1rem 2rem}.products-grid{grid-template-columns:1fr}.hero-product-img{max-width:300px}}
    </style>
</head>
<body>
    <!-- Minimal loading screen -->
    <div id="loading" class="loading">
        <div class="loading-text">BOBBY</div>
    </div>

    <!-- Main content optimized for LCP -->
    <div id="main" class="hidden">
        <!-- Minimal nav with optimized logo -->
        <nav class="navbar">
            <div class="nav-container">
                <a href="#" class="nav-brand">
                    <picture>
                        <source srcset="assets/optimized/bobby-logo.webp" type="image/webp">
                        <img src="assets/bobby-logo.svg" alt="Bobby" class="nav-logo-img optimized-img" width="40" height="40">
                    </picture>
                    BUNGI X BOBBY
                </a>
                <ul class="nav-menu">
                    <li><a href="#" class="nav-link">HOME</a></li>
                    <li><a href="products.html" class="nav-link">SHOP</a></li>
                </ul>
                <button class="cart-btn" id="cart-btn">
                    üõí <span id="cart-count">0</span>
                </button>
            </div>
        </nav>

        <!-- Hero optimized for LCP with WebP image -->
        <section class="hero">
            <div>
                <h1 class="hero-title">
                    BUNGI X BOBBY
                    <span class="subtitle">THE TECH ANIMAL COLLECTION</span>
                </h1>
                <p class="hero-desc">Tech animal of the elite GooberMcGeet club</p>
                
                <!-- Optimized hero image for LCP -->
                <picture class="hero-product-img">
                    <source srcset="assets/optimized/featured-hoodie.webp" type="image/webp">
                    <img src="assets/featured-hoodie.svg" alt="Featured Hoodie" class="optimized-img" width="400" height="400" loading="eager">
                </picture>
                
                <button class="cta-btn" onclick="location.href='products.html'">
                    EXPLORE COLLECTION
                </button>
            </div>
        </section>

        <!-- Products section with lazy-loaded optimized images -->
        <section class="section">
            <div class="container">
                <h2 class="section-title">COLLECTION</h2>
                <div id="products" class="products-grid">
                    <div style="grid-column:1/-1;text-align:center;padding:2rem;color:#666">
                        Loading products...
                    </div>
                </div>
            </div>
        </section>

        <!-- About section -->
        <section class="section">
            <div class="container">
                <h2 class="section-title">ABOUT BOBBY</h2>
                <p style="text-align:center;max-width:700px;margin:0 auto;color:#ccc;line-height:1.6">
                    In the digital underground, Bobby the Rabbit reigns supreme as the ultimate Tech Animal of the elite GooberMcGeet Club.
                </p>
            </div>
        </section>

        <!-- Footer -->
        <footer class="footer">
            <div class="container">
                <h3 class="footer-title">BUNGI X BOBBY</h3>
                <p class="footer-text">¬© 2025 Tech animal of the elite GooberMcGeet club</p>
            </div>
        </footer>
    </div>

    <!-- Ultra-optimized inline JavaScript with image optimization -->
    <script>
        // Performance marks
        performance.mark('js-start');
        
        // Image optimization utilities
        const ImageOptimizer = {
            supportsWebP: null,
            
            async checkWebPSupport() {
                if (this.supportsWebP !== null) return this.supportsWebP;
                
                return new Promise(resolve => {
                    const webP = new Image();
                    webP.onload = webP.onerror = () => {
                        this.supportsWebP = webP.height === 2;
                        resolve(this.supportsWebP);
                    };
                    webP.src = 'data:image/webp;base64,UklGRjoAAABXRUJQVlA4IC4AAACyAgCdASoCAAIALmk0mk0iIiIiIgBoSygABc6WWgAA/veff/0PP8bA//LwYAAA';
                });
            },
            
            getOptimizedImageSrc(originalSrc) {
                if (!this.supportsWebP) return originalSrc;
                
                // Map original images to WebP versions
                const imageMap = {
                    'assets/bobby-logo.svg': 'assets/optimized/bobby-logo.webp',
                    'assets/featured-hoodie.svg': 'assets/optimized/featured-hoodie.webp',
                    'assets/cookie_high.png': 'assets/optimized/cookie_high.webp',
                    'assets/tee-1.png': 'assets/optimized/tee-1.webp',
                    'assets/pants-1.png': 'assets/optimized/pants-1.webp'
                };
                
                return imageMap[originalSrc] || originalSrc;
            },
            
            createOptimizedImage(src, alt, className = '', loading = 'lazy') {
                const picture = document.createElement('picture');
                
                // WebP source
                const webpSrc = this.getOptimizedImageSrc(src);
                if (webpSrc !== src) {
                    const source = document.createElement('source');
                    source.srcset = webpSrc;
                    source.type = 'image/webp';
                    picture.appendChild(source);
                }
                
                // Fallback image
                const img = document.createElement('img');
                img.src = src;
                img.alt = alt;
                img.className = className;
                img.loading = loading;
                picture.appendChild(img);
                
                return picture;
            }
        };
        
        // Ultra-minimal cart with pricing preservation
        const cart = {
            items: [],
            discounts: {},
            init() {
                try {
                    this.items = JSON.parse(localStorage.getItem('bobby-cart') || '[]');
                    this.discounts = JSON.parse(localStorage.getItem('bobby-cart-discounts') || '{}');
                } catch (e) {
                    this.items = [];
                    this.discounts = {};
                }
                this.updateCount();
            },
            updateCount() {
                const el = document.getElementById('cart-count');
                if (el) el.textContent = this.items.reduce((s, i) => s + (i.quantity || 0), 0);
            },
            add(id, productData = {}) {
                const item = {
                    id, 
                    quantity: 1, 
                    time: Date.now(),
                    title: productData.title || 'Product',
                    price: productData.price || 0,
                    originalPrice: productData.originalPrice || productData.price || 0,
                    salePrice: productData.salePrice,
                    discountPercentage: productData.discountPercentage,
                    image: productData.image,
                    variantId: productData.variantId || id
                };
                
                this.items.push(item);
                try {
                    localStorage.setItem('bobby-cart', JSON.stringify(this.items));
                    localStorage.setItem('bobby-cart-discounts', JSON.stringify(this.discounts));
                } catch (e) {}
                this.updateCount();
                this.showNotification(item);
            },
            open() {
                if (!window.fullCart) {
                    const scripts = [
                        'scripts/performance-bundle.js',
                        'scripts/cart-pricing-fix.js'
                    ];
                    
                    let loaded = 0;
                    scripts.forEach(src => {
                        const s = document.createElement('script');
                        s.src = src;
                        s.async = true;
                        s.onload = () => {
                            loaded++;
                            if (loaded === scripts.length) {
                                window.fullCart = true;
                                if (window.BobbyCartEnhanced) {
                                    window.BobbyCartEnhanced.items = this.items;
                                    window.BobbyCartEnhanced.discounts = this.discounts;
                                    window.BobbyCartEnhanced.openCart();
                                } else if (window.BobbyCart) {
                                    window.BobbyCart.items = this.items;
                                    window.BobbyCart.openCart();
                                }
                            }
                        };
                        document.head.appendChild(s);
                    });
                } else if (window.BobbyCartEnhanced) {
                    window.BobbyCartEnhanced.openCart();
                } else if (window.BobbyCart) {
                    window.BobbyCart.openCart();
                }
            },
            showNotification(item) {
                const n = document.createElement('div');
                n.style.cssText = 'position:fixed;top:80px;right:20px;background:#00ff88;color:#000;padding:1rem;border-radius:4px;z-index:10001;font-weight:600;max-width:300px';
                
                let message = `Added ${item.title || 'item'} to cart!`;
                if (item.salePrice && item.originalPrice && item.salePrice < item.originalPrice) {
                    const savings = item.originalPrice - item.salePrice;
                    message += ` (Save $${savings.toFixed(2)})`;
                }
                
                n.textContent = message;
                document.body.appendChild(n);
                setTimeout(() => n.remove(), 2000);
            }
        };
        
        // Show site immediately
        function showSite() {
            const loading = document.getElementById('loading');
            const main = document.getElementById('main');
            loading.style.opacity = '0';
            loading.style.transition = 'opacity 0.2s';
            setTimeout(() => {
                loading.style.display = 'none';
                main.classList.remove('hidden');
                performance.mark('site-visible');
                loadEnhancements();
            }, 200);
        }
        
        // Load enhancements after site is visible
        function loadEnhancements() {
            // Check WebP support
            ImageOptimizer.checkWebPSupport();
            
            // Load font
            const f = document.createElement('link');
            f.href = 'https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;600;700&display=swap';
            f.rel = 'stylesheet';
            document.head.appendChild(f);
            
            // Load products with optimized images
            setTimeout(loadProducts, 100);
        }
        
        // Load products with image optimization
        function loadProducts() {
            fetch('/netlify/functions/get-products-admin-api')
                .then(r => r.json())
                .then(d => {
                    const products = d.products || [];
                    if (products.length) {
                        document.getElementById('products').innerHTML = products.slice(0, 4).map(p => {
                            const optimizedImageSrc = ImageOptimizer.getOptimizedImageSrc(p.image || 'assets/product-placeholder.png');
                            
                            return `<div class="product-card">
                                <picture>
                                    <source srcset="${optimizedImageSrc}" type="image/webp">
                                    <img src="${p.image || 'assets/product-placeholder.png'}" alt="${p.title}" class="product-img optimized-img" loading="lazy">
                                </picture>
                                <h3 class="product-title">${p.title}</h3>
                                <p class="product-price">$${p.variants?.[0]?.price || 'N/A'}</p>
                                <button class="add-btn" onclick="cart.add('${p.id}', {title:'${p.title}',price:${p.variants?.[0]?.price || 0},image:'${p.image || ''}'})">Add to Cart</button>
                            </div>`;
                        }).join('') + 
                        '<div style="grid-column:1/-1;text-align:center;margin-top:2rem"><button class="cta-btn" onclick="location.href=\'products.html\'">VIEW ALL PRODUCTS</button></div>';
                    } else {
                        showFallback();
                    }
                })
                .catch(showFallback);
        }
        
        function showFallback() {
            document.getElementById('products').innerHTML = 
                '<div style="grid-column:1/-1;text-align:center;padding:2rem"><p style="margin-bottom:2rem;color:#ccc">Discover our exclusive collection</p><button class="cta-btn" onclick="location.href=\'products.html\'">SHOP NOW</button></div>';
        }
        
        // Initialize
        cart.init();
        document.getElementById('cart-btn').onclick = () => cart.open();
        
        // Show site ASAP
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => setTimeout(showSite, 50));
        } else {
            setTimeout(showSite, 50);
        }
        
        performance.mark('js-end');
        
        // Performance logging
        window.addEventListener('load', () => {
            setTimeout(() => {
                const nav = performance.getEntriesByType('navigation')[0];
                if (nav) {
                    console.log('Image-Optimized Performance:', {
                        'FCP': Math.round(nav.domContentLoadedEventEnd - nav.domContentLoadedEventStart) + 'ms',
                        'Load': Math.round(nav.loadEventEnd - nav.fetchStart) + 'ms',
                        'TTI': Math.round(nav.domContentLoadedEventEnd - nav.fetchStart) + 'ms'
                    });
                }
            }, 100);
        });
    </script>
</body>
</html>