<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bungi x Bobby | Dynamic Product Test</title>
    <link rel="stylesheet" href="styles/main.css">
    <link rel="stylesheet" href="styles/cart-styles.css">
    
    <!-- Script Loader to prevent duplicate script loading -->
    <script src="scripts/script-loader-fix.js"></script>
    
    <!-- Product Variant Mapping Script -->
    <script src="scripts/product-variant-mapping.js"></script>
    
    <style>
        .container {
            max-width: 1200px;
            margin: 40px auto;
            padding: 20px;
        }
        
        .page-title {
            color: #7877c6;
            font-size: 2rem;
            text-align: center;
            margin-bottom: 30px;
        }
        
        .info-box {
            background: rgba(120, 119, 198, 0.1);
            border: 1px solid rgba(120, 119, 198, 0.3);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 30px;
        }
        
        .info-box h2 {
            color: #7877c6;
            margin-top: 0;
        }
        
        .info-box p {
            margin-bottom: 0;
        }
        
        .actions {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .btn {
            background: linear-gradient(45deg, #7877c6, #a855f7);
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            color: white;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(120, 119, 198, 0.3);
        }
        
        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 30px;
            margin-top: 30px;
        }
        
        .product-card {
            background: rgba(20, 20, 35, 0.95);
            border-radius: 8px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            transition: transform 0.3s ease;
        }
        
        .product-card:hover {
            transform: translateY(-5px);
        }
        
        .product-image-container {
            height: 240px;
            overflow: hidden;
        }
        
        .product-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s ease;
        }
        
        .product-card:hover .product-image {
            transform: scale(1.05);
        }
        
        .product-details {
            padding: 20px;
        }
        
        .product-title {
            color: white;
            font-size: 1.2rem;
            margin: 0 0 10px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .product-price {
            color: #a855f7;
            font-weight: bold;
            font-size: 1.25rem;
            margin-bottom: 15px;
        }
        
        .add-to-cart-btn {
            background: linear-gradient(45deg, #7877c6, #a855f7);
            border: none;
            padding: 10px 0;
            border-radius: 4px;
            color: white;
            cursor: pointer;
            width: 100%;
            font-weight: 600;
            transition: all 0.2s;
        }
        
        .add-to-cart-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(120, 119, 198, 0.3);
        }
        
        .loading-container {
            text-align: center;
            padding: 30px;
        }
        
        .loading-spinner {
            border: 5px solid rgba(120, 119, 198, 0.3);
            border-radius: 50%;
            border-top: 5px solid #7877c6;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="page-title">Dynamic Product Test</h1>
        
        <div class="info-box">
            <h2>Automatic Product Loading with Real Shopify Variant IDs</h2>
            <p>This page demonstrates dynamically loading products directly from Shopify with their correct variant IDs in GID format. Add the products to your cart and proceed to checkout to test the complete flow.</p>
        </div>
        
        <div class="actions">
            <button class="btn" id="open-cart">View Cart</button>
            <button class="btn" id="direct-checkout">Direct Checkout</button>
            <button class="btn" id="clear-cart">Clear Cart</button>
            <button class="btn" id="reload-products">Reload Products</button>
        </div>
        
        <!-- Product Grid - Will be populated by DynamicProductLoader -->
        <div class="product-grid" 
             data-dynamic-product-loader="auto"
             data-shopify-domain="your-store.myshopify.com" 
             data-storefront-token="your-storefront-token"
             data-product-limit="6">
            <!-- Loading indicator -->
            <div class="loading-container">
                <div class="loading-spinner"></div>
                <p>Loading products from Shopify...</p>
            </div>
        </div>
    </div>
    
    <!-- Scripts -->
    <script>
        // Initialize with script loader to prevent duplicates
        if (window.BobbyScriptLoader) {
            // Load cart scripts in the correct order
            BobbyScriptLoader.loadOnce('simple-cart-system', 'scripts/simple-cart-system.js', function() {
                BobbyScriptLoader.loadOnce('cart-bridge-fix', 'scripts/cart-bridge-fix.js', function() {
                    BobbyScriptLoader.loadOnce('cart-duplicate-fix', 'scripts/cart-duplicate-fix.js', function() {
                        BobbyScriptLoader.loadOnce('cart-render-fix', 'scripts/cart-render-fix.js', function() {
                            // Finally load the dynamic product loader
                            BobbyScriptLoader.loadOnce('dynamic-product-loader', 'scripts/dynamic-product-loader.js', function() {
                                initPage();
                            });
                        });
                    });
                });
            });
        } else {
            // Fallback if script loader isn't available
            loadScript('scripts/simple-cart-system.js', function() {
                loadScript('scripts/cart-bridge-fix.js', function() {
                    loadScript('scripts/cart-duplicate-fix.js', function() {
                        loadScript('scripts/cart-render-fix.js', function() {
                            loadScript('scripts/dynamic-product-loader.js', function() {
                                initPage();
                            });
                        });
                    });
                });
            });
            
            function loadScript(src, callback) {
                const script = document.createElement('script');
                script.src = src;
                script.onload = callback;
                document.head.appendChild(script);
            }
        }
        
        // Initialize page after scripts are loaded
        function initPage() {
            console.log('Initializing dynamic product test page...');
            
            // Set up button actions
            document.getElementById('open-cart').addEventListener('click', function() {
                console.log('Opening cart...');
                if (window.BobbyCart && typeof window.BobbyCart.openCart === 'function') {
                    window.BobbyCart.openCart();
                } else if (window.cartManager && typeof window.cartManager.openCart === 'function') {
                    window.cartManager.openCart();
                } else {
                    console.error('No cart system available to open cart');
                }
            });
            
            document.getElementById('direct-checkout').addEventListener('click', function() {
                console.log('Initiating direct checkout...');
                if (window.BobbyCart && typeof window.BobbyCart.proceedToCheckout === 'function') {
                    window.BobbyCart.proceedToCheckout();
                } else if (window.cartManager && typeof window.cartManager.proceedToCheckout === 'function') {
                    window.cartManager.proceedToCheckout();
                } else {
                    console.error('No cart system available for checkout');
                }
            });
            
            document.getElementById('clear-cart').addEventListener('click', function() {
                console.log('Clearing cart...');
                if (window.BobbyCart && typeof window.BobbyCart.clearCart === 'function') {
                    window.BobbyCart.clearCart();
                } else if (window.cartManager && typeof window.cartManager.clearCart === 'function') {
                    window.cartManager.clearCart();
                } else {
                    console.error('No cart system available to clear cart');
                }
            });
            
            document.getElementById('reload-products').addEventListener('click', function() {
                console.log('Reloading products...');
                // Create new instance with same configuration
                const container = document.querySelector('[data-dynamic-product-loader="auto"]');
                new DynamicProductLoader({
                    shopifyDomain: container.getAttribute('data-shopify-domain'),
                    storefrontToken: container.getAttribute('data-storefront-token'),
                    productLimit: parseInt(container.getAttribute('data-product-limit'), 10) || 10,
                    container: '.product-grid'
                });
            });
            
            console.log('Dynamic product test page initialized successfully.');
        }
    </script>
</body>
</html>