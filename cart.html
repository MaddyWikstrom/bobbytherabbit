<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Your Cart - Bobby Streetwear</title>
    <link rel="stylesheet" href="styles/main.css">
    <link rel="stylesheet" href="styles/products.css">
    <link rel="stylesheet" href="styles/animations.css">
    <link rel="stylesheet" href="styles/loading.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        .cart-page-container {
            max-width: 1200px;
            margin: 40px auto;
            padding: 20px;
        }
        
        .cart-title {
            text-align: center;
            margin-bottom: 30px;
            font-size: 2rem;
            color: #fff;
        }
        
        .cart-items-wrapper {
            background: rgba(20, 20, 35, 0.8);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 30px;
            border: 1px solid rgba(120, 119, 198, 0.3);
        }
        
        .cart-item {
            display: flex;
            padding: 20px;
            margin-bottom: 15px;
            border-bottom: 1px solid rgba(120, 119, 198, 0.2);
            position: relative;
            background: rgba(30, 30, 50, 0.5);
            border-radius: 8px;
            transition: all 0.3s ease;
        }
        
        .cart-item:hover {
            background: rgba(40, 40, 60, 0.7);
        }
        
        .cart-item-image-container {
            width: 100px;
            height: 100px;
            position: relative;
            margin-right: 20px;
            border-radius: 8px;
            overflow: hidden;
            border: 1px solid rgba(120, 119, 198, 0.3);
            background: rgba(20, 20, 35, 0.5);
        }
        
        .cart-item-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        }
        
        .cart-item-placeholder {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 100%;
            color: rgba(120, 119, 198, 0.7);
            font-size: 24px;
        }
        
        .cart-item-info {
            flex: 1;
        }
        
        .cart-item-title {
            font-weight: bold;
            color: #fff;
            margin-bottom: 5px;
            font-size: 1.2rem;
        }
        
        .cart-item-variant {
            color: rgba(255, 255, 255, 0.5);
            font-size: 0.9rem;
            margin-bottom: 10px;
        }
        
        .cart-item-price {
            color: #a855f7;
            font-weight: bold;
            margin-top: 10px;
            font-size: 1.1rem;
        }
        
        .cart-item-controls {
            display: flex;
            align-items: center;
            margin-top: 15px;
        }
        
        .quantity-btn {
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(120, 119, 198, 0.2);
            border: none;
            color: white;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 1.2rem;
        }
        
        .quantity-btn:hover {
            background: rgba(120, 119, 198, 0.4);
        }
        
        .quantity-display {
            margin: 0 15px;
            color: white;
            min-width: 20px;
            text-align: center;
            font-size: 1rem;
        }
        
        .remove-item-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(255, 85, 85, 0.1);
            border: none;
            color: rgba(255, 255, 255, 0.7);
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 18px;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }
        
        .remove-item-btn:hover {
            color: #ff5555;
            background: rgba(255, 85, 85, 0.2);
        }
        
        .cart-summary {
            background: rgba(20, 20, 35, 0.8);
            border-radius: 8px;
            padding: 20px;
            border: 1px solid rgba(120, 119, 198, 0.3);
        }
        
        .cart-total {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            color: #ffffff;
            font-weight: bold;
            font-size: 1.2rem;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(120, 119, 198, 0.3);
        }
        
        .checkout-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(45deg, #a855f7, #3b82f6);
            border: none;
            border-radius: 8px;
            color: #ffffff;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            font-size: 1.1rem;
        }
        
        .checkout-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(120, 119, 198, 0.4);
        }
        
        .continue-shopping {
            display: block;
            text-align: center;
            margin-top: 20px;
            color: rgba(255, 255, 255, 0.7);
            text-decoration: none;
            transition: color 0.2s ease;
        }
        
        .continue-shopping:hover {
            color: #a855f7;
        }
        
        .empty-cart-page {
            text-align: center;
            padding: 50px 20px;
        }
        
        .empty-cart-icon {
            margin-bottom: 20px;
            opacity: 0.6;
        }
        
        .empty-cart-page h2 {
            color: #ffffff;
            margin-bottom: 15px;
            font-size: 1.8rem;
        }
        
        .empty-cart-page p {
            margin-bottom: 25px;
            color: rgba(255, 255, 255, 0.7);
            font-size: 1.1rem;
        }
        
        .shop-now-btn {
            display: inline-block;
            padding: 12px 25px;
            background: linear-gradient(45deg, #a855f7, #3b82f6);
            color: white;
            text-decoration: none;
            border-radius: 8px;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .shop-now-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(120, 119, 198, 0.4);
        }
        
        @media (max-width: 768px) {
            .cart-item {
                flex-direction: column;
                padding: 15px;
            }
            
            .cart-item-image-container {
                width: 100%;
                height: 200px;
                margin-right: 0;
                margin-bottom: 15px;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <img src="assets/bobby-logo.svg" alt="Bobby" class="nav-logo-img">
                <span class="nav-brand">BUNGI X BOBBY</span>
                <div class="logo-banner">
                    <div class="logo-container">
                      <img src="assets/hat.png" class="banner-logo hat" alt="Hat logo" />
                      <img src="assets/cookie.png" class="banner-logo cookie" alt="Cookie logo" />
                      <img src="assets/bunny.png" class="banner-logo bunny" alt="Bunny logo" />
                      <img src="assets/b.png" class="banner-logo b" alt="B logo" />
                    </div>
                  </div>
            </div>
            <ul class="nav-menu">
                <li class="nav-item"><a href="index.html" class="nav-link glitch-hover" data-text="HOME">HOME</a></li>
                <li class="nav-item"><a href="products.html" class="nav-link glitch-hover" data-text="SHOP">SHOP</a></li>
                <li class="nav-item"><a href="index.html#collection" class="nav-link glitch-hover" data-text="COLLECTION">COLLECTION</a></li>
                <li class="nav-item"><a href="index.html#about" class="nav-link glitch-hover" data-text="ABOUT">ABOUT</a></li>
                <li class="nav-item"><a href="index.html#contact" class="nav-link glitch-hover" data-text="CONTACT">CONTACT</a></li>
            </ul>
            <div class="nav-actions">
                <button class="cart-btn" id="cart-btn">
                    <span class="cart-icon">ðŸ›’</span>
                    <span class="cart-count">0</span>
                </button>
                <div class="social-links">
                    <a href="https://instagram.com/bungi_bobby_the_rabbit" class="social-link instagram" target="_blank">
                        <span class="hologram-btn">
                            <img src="assets/instagram-logo.svg" alt="Instagram" class="social-icon">
                        </span>
                    </a>
                    <a href="https://tiktok.com/@bungi__" class="social-link tiktok" target="_blank">
                        <span class="hologram-btn">
                            <img src="assets/tiktok-logo.svg" alt="TikTok" class="social-icon">
                        </span>
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="cart-page-container">
        <h1 class="cart-title">Your Shopping Cart</h1>
        
        <!-- Cart will be populated by JS -->
        <div id="cart-page-content">
            <!-- Empty cart state by default -->
            <div class="empty-cart-page">
                <div class="empty-cart-icon">
                    <svg width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
                        <circle cx="9" cy="21" r="1"></circle>
                        <circle cx="20" cy="21" r="1"></circle>
                        <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
                    </svg>
                </div>
                <h2>Your cart is empty</h2>
                <p>Looks like you haven't added any items to your cart yet.</p>
                <a href="products.html" class="shop-now-btn">Shop Now</a>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3 class="footer-title">BUNGI X BOBBY</h3>
                    <p class="footer-text">Tech animal of the elite GooberMcGeet club</p>
                    <div class="social-links-footer">
                        <a href="https://instagram.com/bungi_bobby_the_rabbit" class="social-link" target="_blank">
                            <span class="hologram-btn">
                                <img src="assets/instagram-logo.svg" alt="Instagram" class="social-icon">
                            </span>
                        </a>
                        <a href="https://tiktok.com/@bungi__" class="social-link" target="_blank">
                            <span class="hologram-btn">
                                <img src="assets/tiktok-logo.svg" alt="TikTok" class="social-icon">
                            </span>
                        </a>
                    </div>
                </div>
                <div class="footer-section">
                    <h3 class="footer-title">QUICK LINKS</h3>
                    <ul class="footer-links">
                        <li><a href="index.html">Home</a></li>
                        <li><a href="products.html">Products</a></li>
                        <li><a href="#about">About</a></li>
                        <li><a href="#contact">Contact</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h3 class="footer-title">CONTACT</h3>
                    <p class="footer-text">bungi.bobby@gmail.com</p>
                </div>
            </div>
            <div class="footer-bottom">
                <div class="ascii-footer">
                    <pre>
      _______  ________   _______   _______   ________      ________       _______  _______    _______   _______  ________
      //      / /    /   \//   /   \//       \ /        \    /    /   \    //      / /       \\//      / //      / /    /   \
     //       \/         //        //      __/_/       /    /_       _/   //       \/        ///       \//       \/         /
    /         /        //         /       / //         /   /         /   /         /         /         /         /\__     //
    \________/\_______//\__/_____/\________/ \\_______/    \___/___//    \________/\________/\________/\________/   \____//
     </pre>
                </div>
                <p class="copyright">Â© 2025 BUNGI X BOBBY. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- Cart Sidebar -->
    <div class="cart-sidebar" id="cart-sidebar">
        <div class="cart-header">
            <h3>Your Cart</h3>
            <button class="cart-close" id="cart-close">Ã—</button>
        </div>
        <div class="cart-items-container">
            <div id="cart-items" class="cart-items"></div>
        </div>
        <div class="cart-footer">
            <div class="cart-total">
                <span>Total:</span>
                <span>$<span id="cart-total">0.00</span></span>
            </div>
            <button class="checkout-btn" id="checkout-btn">
                <span>Checkout</span>
            </button>
        </div>
    </div>

    <!-- Cart Overlay -->
    <div class="cart-overlay" id="cart-overlay"></div>

    <!-- Scripts -->
    <script src="scripts/product.js"></script>
    <script src="scripts/animations.js"></script>
    
    <!-- Critical fixes -->
    <script src="scripts/mobile-navigation.js"></script>
    <script src="scripts/image-loader-fix.js"></script>
    
    <!-- Emergency cart image fix -->
    <script src="scripts/cart-image-emergency-fix.js"></script>
    
    <!-- Completely redone cart and checkout system -->
    <script src="scripts/cart-checkout-system.js"></script>
    
    <!-- Cart page specific script -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Make sure BobbyCarts is initialized
            if (window.BobbyCarts) {
                // Render cart contents to the page
                renderCartPage();
                
                // Listen for cart updates
                document.addEventListener('cartUpdated', renderCartPage);
            }
            
            function renderCartPage() {
                const cartContent = document.getElementById('cart-page-content');
                
                // Check if cart is empty
                if (BobbyCarts.state.items.length === 0) {
                    // Show empty cart message
                    cartContent.innerHTML = `
                        <div class="empty-cart-page">
                            <div class="empty-cart-icon">
                                <svg width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
                                    <circle cx="9" cy="21" r="1"></circle>
                                    <circle cx="20" cy="21" r="1"></circle>
                                    <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
                                </svg>
                            </div>
                            <h2>Your cart is empty</h2>
                            <p>Looks like you haven't added any items to your cart yet.</p>
                            <a href="products.html" class="shop-now-btn">Shop Now</a>
                        </div>
                    `;
                } else {
                    // Generate cart items HTML
                    const itemsHTML = BobbyCarts.state.items.map(item => {
                        const price = item.price * item.quantity;
                        
                        return `
                            <div class="cart-item" data-item-id="${item.id}" data-product-id="${item.productId}" data-shopify-id="${item.shopifyId || ''}">
                                <div class="cart-item-image-container">
                                    <img src="${item.image}" alt="${item.title}" class="cart-item-image"
                                        data-product-id="${item.productId}"
                                        data-shopify-id="${item.shopifyId || ''}"
                                        data-title="${item.title}"
                                        onerror="
                                            // Try to find a product image from PRODUCT_MAPPING first
                                            if (window.PRODUCT_MAPPING) {
                                                const itemId = this.getAttribute('data-product-id');
                                                const shopifyId = this.getAttribute('data-shopify-id');
                                                const title = this.getAttribute('data-title');
                                                
                                                // Look for matching product
                                                for (const handle in window.PRODUCT_MAPPING) {
                                                    const product = window.PRODUCT_MAPPING[handle];
                                                    if ((itemId && handle === itemId) || 
                                                        (shopifyId && product.shopifyProductId === shopifyId) ||
                                                        (title && product.shopifyProductId.toLowerCase().includes(title.toLowerCase()))) {
                                                        
                                                        // Use first variant image
                                                        if (product.variants && product.variants.length > 0) {
                                                            this.src = product.variants[0].image;
                                                            console.log('Fixed cart image using product mapping:', handle);
                                                            return;
                                                        }
                                                    }
                                                }
                                            }
                                            
                                            // If that failed, try direct Shopify CDN URL
                                            if (this.getAttribute('data-product-id')) {
                                                const cdnUrl = 'https://cdn.shopify.com/s/files/1/0701/3947/8183/files/unisex-premium-hoodie-black-front-683f9d11a7936.png';
                                                this.src = cdnUrl;
                                                console.log('Trying fallback Shopify CDN URL');
                                                return;
                                            }
                                            
                                            // If still failed, fall back to standard error handling
                                            this.style.display='none'; 
                                            this.nextElementSibling.style.display='flex'; 
                                            this.nextElementSibling.nextElementSibling.style.display='block';
                                        ">
                                    <div class="cart-item-placeholder" style="display:none;">?</div>
                                    <button class="image-retry-btn" style="display:none;">Retry</button>
                                </div>
                                <div class="cart-item-info">
                                    <div class="cart-item-title">${item.title}</div>
                                    ${item.variantText ? `<div class="cart-item-variant">${item.variantText}</div>` : ''}
                                    <div class="cart-item-price">$${price.toFixed(2)}</div>
                                    <div class="cart-item-controls">
                                        <button class="quantity-btn decrease">-</button>
                                        <span class="quantity-display">${item.quantity}</span>
                                        <button class="quantity-btn increase">+</button>
                                    </div>
                                </div>
                                <button class="remove-item-btn" title="Remove item">&times;</button>
                            </div>
                        `;
                    }).join('');
                    
                    // Create cart page HTML
                    cartContent.innerHTML = `
                        <div class="cart-items-wrapper">
                            ${itemsHTML}
                        </div>
                        <div class="cart-summary">
                            <div class="cart-total">
                                <span>Total:</span>
                                <span>$${BobbyCarts.state.total.toFixed(2)}</span>
                            </div>
                            <button class="checkout-btn" id="page-checkout-btn">
                                <span>Proceed to Checkout</span>
                            </button>
                            <a href="products.html" class="continue-shopping">Continue Shopping</a>
                        </div>
                    `;
                    
                    // Set up event handlers for cart items
                    setupCartPageEvents();
                }
            }
            
            function setupCartPageEvents() {
                // Quantity decrease buttons
                document.querySelectorAll('.cart-items-wrapper .quantity-btn.decrease').forEach(btn => {
                    const itemId = btn.closest('.cart-item').dataset.itemId;
                    const item = BobbyCarts.state.items.find(item => item.id === itemId);
                    
                    if (item) {
                        btn.addEventListener('click', function() {
                            BobbyCarts.updateQuantity(itemId, item.quantity - 1);
                        });
                    }
                });
                
                // Quantity increase buttons
                document.querySelectorAll('.cart-items-wrapper .quantity-btn.increase').forEach(btn => {
                    const itemId = btn.closest('.cart-item').dataset.itemId;
                    const item = BobbyCarts.state.items.find(item => item.id === itemId);
                    
                    if (item) {
                        btn.addEventListener('click', function() {
                            BobbyCarts.updateQuantity(itemId, item.quantity + 1);
                        });
                    }
                });
                
                // Remove buttons
                document.querySelectorAll('.cart-items-wrapper .remove-item-btn').forEach(btn => {
                    const itemId = btn.closest('.cart-item').dataset.itemId;
                    
                    btn.addEventListener('click', function() {
                        BobbyCarts.removeItem(itemId);
                    });
                });
                
                // Checkout button
                const checkoutBtn = document.getElementById('page-checkout-btn');
                if (checkoutBtn) {
                    checkoutBtn.addEventListener('click', function() {
                        BobbyCarts.proceedToCheckout();
                    });
                }
            }
        });
    </script>
</body>
</html>